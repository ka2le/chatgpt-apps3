javascript:(function() {!function(){function e(e,t,n){var o=document.getElementsByTagName("head")[0],a=document.createElement("script");a.type="text/javascript",a.onerror=function(){var e;t&&((e=document.createElement("script")).type="text/javascript",e.src=t,e.onreadystatechange=n,e.onload=n,o.appendChild(e))},a.src=e,a.onreadystatechange=n,a.onload=n,o.appendChild(a)}console.log("GPT MAIN: 1685875502089");var t="http://localhost:3000/chatgpt-apps3/bookmarklets/min/utils.min.js?"+(new Date).getTime(),n="https://ka2le.github.io/chatgpt-apps3/bookmarklets/min/utils.min.js?"+(new Date).getTime();e("https://unpkg.com/preact@latest/dist/preact.umd.js",null,function(){e("https://unpkg.com/htm@latest/dist/htm.umd.js",null,function(){e("https://unpkg.com/preact@latest/hooks/dist/hooks.umd.js",null,function(){window.h=preact.h,window.render=preact.render,window.html=htm.bind(h),window.useState=preactHooks.useState,window.useEffect=preactHooks.useEffect,window.useRef=preactHooks.useRef,window.useMemo=preactHooks.useMemo,e(t,n,function(){n=window.render,E=window.html,k=window.useState,x=window.useEffect,B=window.useRef,S=window.useMemo;var n,E,k,x,B,S,e=function(){const[t,n]=k(!1),[e,o]=k("ALL"),[a,i]=k(!1),[l,r]=k("DND"!=e),[s,d]=k(""),c=B(null),u=B(null),m=["STR","DEX","CON","INT","WIS","CHA"],g=[-2,-1,0,1,2,3,4,5],[p,h]=k({STR:0,DEX:0,CON:0,INT:0,WIS:0,CHA:0}),f=e=>{var t;c.current&&(t=c.current.value.replace(/\[.*?\]/s,""),c.current.value=t+"["+e+"]",c.current.dispatchEvent(new Event("input",{bubbles:!0})))},v=()=>{u.current&&"BUTTON"===u.current.tagName&&(u.current.disabled=!1,u.current.click())},y=(x(()=>{f(s)},[s]),()=>{i(!a)}),b=()=>{console.log("Button clicked!")},[w,T]=k(!1);var $=S(()=>({standardAbilities:m,standardScoreOptions:g,toggleOverlay:y,isOverlayOpen:a,toggleToolWindow:()=>{r(!l)},isToolWindowVisible:l,setAdditionalText:d,mode:e,setMode:o,addToAddtionalText:e=>{d(s+e)},haveRemoved:t,setHaveRemoved:n,triggerRender:w,textAreaRef:c,sendButtonRef:u,insertTextInPrompt:f,sendText:e=>{console.log("Sending"+e),f(e),v()},pressSend:v,abilityScores:p,setAbilityScores:h}),[y,a,t,n,w,l,r,c,u,p]);return useComponentContainer(N,findToolBarContainerDOM,$),useComponentContainer(R,findOverlayContainerDOM,$),x(()=>{c.current=document.getElementById("prompt-textarea"),u.current=document.getElementById("prompt-textarea").nextElementSibling},[]),x(function(){var l,e;removeElementsByClass("gpt-enhancer",t,n),O(),A(),u.current&&u.current.addEventListener("click",b),l=[function(){console.log("Callbak from Class Observer function running")},function(){A()},function(){O()},function(){addStyling()},function(){T(e=>!e)}],e=document.querySelector("main"),console.log("Adding class Observer with "+e.classList+"as the selected wathcer"),new MutationObserver(function(e,t){let n=!1;for(var o of e){var a;"attributes"===o.type&&"class"===o.attributeName&&(a=o.target,o=o.oldValue&&o.oldValue.split(" ").includes("result-streaming"),a=a.classList.contains("result-streaming"),!o&&a?console.log('A node has gained the class "result-streaming".'):o&&!a&&(console.log('A node has lost the class "result-streaming".'),n=!0))}if(n){console.log("Running CallBacks");for(var i=0;i<l.length;i++)l[i]()}}).observe(e,{attributes:!0,childList:!0,subtree:!0,attributeFilter:["class"],attributeOldValue:!0}),addObserver([function(){O()},function(){A()},function(){console.log("Callbak function running")},function(){addStyling()},function(){T(e=>!e)}]),addStyling()},[t,T,w]),E`<${function(e){return E`
                <div 
                style=${{display:e.isToolWindowVisible?"block":"none",...utilVars.toolWindowStyle}}
                    id="toolWindow"
                    class="gpt-enhancer group  w-full text-gray-800 dark:text-gray-100 border-b border-black/10 dark:border-gray-900/50 dark:bg-gray-800">
                    <div><h2>toolWindow</h2></div>
                    <${TextArea}
                        id="codeBox"
                        class="flex flex-col w-full py-[10px] flex-grow md:py-4 md:pl-4 relative border border-black/10 bg-white dark:border-gray-900/50 dark:text-white dark:bg-gray-700 rounded-xl shadow-xs dark:shadow-xs"
                        style=""
                    />${Button("RunJS",C)}
                </div>
            `}} ...${$} />`},t="gpt-enhancer-root",o=(o=t,(o=document.getElementById(o))&&o.remove(),document.createElement("div"));function A(){for(var e=document.getElementsByTagName("main")[0].getElementsByTagName("ol"),t=0;t<e.length;t++)for(var n,o,a,i=e[t].getElementsByTagName("li"),l=0;l<i.length;l++)i[l].classList.contains("has-checkbox")||((n=document.createElement("input")).type="checkbox",o=l+1,a=i[l].innerHTML.replace(/<[^>]*>?/gm,""),n.dataset.listText="Option "+o+": "+a,i[l].style.display="flex",i[l].style.alignItems="center",i[l].insertBefore(n,i[l].firstChild),i[l].classList.add("has-checkbox"))}function C(){var e=document.getElementById("codeBox").value;console.log(e),runJs(e)}function a(e,t){var n=Math.floor(20*Math.random())+1,o=function(e){for(var t=0;t<e.length;t++)if(e[t].checked)return e[t].dataset.listText;return""}(0<(i=document.getElementsByTagName("main")[0].getElementsByTagName("ol")).length?i[i.length-1].getElementsByTagName("input"):[]);let a;t.forEach(e=>{o.includes("("+e+")")&&(a=e)});var i=parseInt(document.getElementById(a+"Dropdown")?.value??0),t=null!=a?-1<i?" + "+i+" "+a:i+" "+a:"",i=n+parseInt(i);e(o+` Result: ${i} (${n} Roll ${t})`)}function O(){document.querySelectorAll("button:not([gpt-enhancer-modified])").forEach(function(e){var t;e.innerText.includes("Copy code")&&(e.setAttribute("gpt-enhancer-modified","true"),t=e.innerText.replace("Copy code","Copy"),e.setAttribute("innerHtml",t),t=document.createElement("div"),n(E`<${RunJsButton} spanElement=${e}/>`,t),addElement(e.parentElement,t,e.nextSibling),t=document.createElement("div"),n(E`<${DownloadSVGButton} spanElement=${e}/>`,t),addElement(e.parentElement,t,e.nextSibling),t=document.createElement("div"),n(E`<${ToggleEditableButton} spanElement=${e}/>`,t),addElement(e.parentElement,t,e.nextSibling))})}function R(e){const[t,n]=k();return E`
                <div class="gpt-enhancer" id="overAll" style=${{display:e.isOverlayOpen?"block":"none",...utilVars.overlayStyle}}>
                <${TextArea} id="overAllText" value=${t} onChange=${e=>n(e.target.value)}/>
                ${Button("Send Message",function(){e.sendText(t)})}
                ${Button("Toggle Overlay",function(){e.toggleOverlay()})}
                <div id="overAllAnswers"></div>
                </div>
            `}function i(e){return"DND"==e.mode||"ALL"==e.mode?E`
            <${function(t){return E`
              <div class="statBlock">
                ${t.standardAbilities.map(e=>E`<${function({ability:e,...t}){return E`
              <div style="${utilVars.abilityStyle}" class="ability">
                <span>${e} </span>
                <${function({ability:n,options:e=[],value:t,setValue:o}){return E`
              <select class="gpt-enhancer" id="${n}Dropdown" style="${utilVars.dropdownStyle}" value="${t}" onchange="${t=>{o(e=>({...e,[n]:t.target.value}))}}">
                ${e.map(e=>E`<option value="${e}">${e}</option>`)}
              </select>
            `}} ability="${e}" options=${t.standardScoreOptions} value=${t.abilityScores[e]} setValue=${t.setAbilityScores} />
              </div>
            `}} ability=${e} ...${t} />`)}
              </div>
            `}} ...${e} />
            ${Button("Roll D20",function(){a(e.setAdditionalText,e.standardAbilities)})}            
            ${Button("Correction",function(){e.addToAddtionalText(`
Remember that a poor Result below 10 should have negative consequenses and below 5 should be really bad. Also remember to always advance the story and offer interesting options. The options should always contain one related ability in paranthesis like (STR)`)})}
            `:""}function N(e){return E`
                <div 
                    id="toolBar" class="gpt-enhancer">
                    <${i} ...${e} />
                    <${function(e){if("CODE"==e.mode||"ALL"==e.mode)return E`
                ${Button("Toolwindow",function(){e.toggleToolWindow()})}
                ${Button("RunJS",C)}
                ${Button("Toggle Overlay",function(){e.toggleOverlay()})}
                ${Button("Correction",function(){e.addToAddtionalText(`When giving the answer, keep this in mind:
I am using Preact and Htm in this Bookmarklet code. The main app i the function TheApp and i want to keep most states in that parent 
Always do comments in the code like /*COMMENT HERE*/ never do // like //COMMENT HERE  `)})}
                ${Button("SendTest",function(){e.sendText("Tell me something interesting")})}
                `}} ...${e} />
                </div>
            `}o.id=t,document.body.appendChild(o),n(E`<${e} />`,o)})})})})}();})();